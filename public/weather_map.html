<!-- EXERCISE 5.6.2 First Part complete, today's weather data populates. -->
<!-- EXERCISE 5.6.2 Refactored for three-day forecast. -->
<!-- EXERCISE 5.6.2 Refactored: User can change latitude, longitude for forecast -->
<!DOCTYPE html>
<html>
<head>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="/css/weather_map.css">
	<title>weather map</title>
	
</head>
<body>
<div id="container">
	<h2>Weather Application</h2>
	<h3 id="location"></h3>
	<div id="row-forecast">

	</div>
	
	<form id="search-form"> 
		<input type="text" id="latitude" name="latitude" placeholder="Enter Latitude">
		<input type="text" id="longitude" name="longitude" placeholder="Enter Longitude">
		<input type="submit" id="submit" name="submit">
	</form>
	
	<div id="map-canvas">

	</div>
</div>

<script type="text/javascript" src="/js/jquery-2.1.4.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDKB6XP6nFJJv5GtKLiF0OecOP5VwOXA5o"></script>
<script type="text/javascript">

$(document).ready(function() {
	google.maps.event.addDomListener(window, 'load', initialize);
});

	// declare variable map for global scope
	var map; 

	// Main function that gets weather API data and parses for display. 
	var runGetWeather = function(lat, lon) {
		console.log(lat);
		console.log(lon);
		$.get("http://api.openweathermap.org/data/2.5/forecast/daily", {
			"APPID": "d00068236e1ca2110cc252b202794ecb",
			"lat":   lat,
	    	"lon":   lon,
	    	"units": "imperial",
			"cnt": 3
		}).done(function(data) {
			htmlString = "";
			console.log(data);
			console.log(data.list);

			for ( i = 0; i < 3; i++) {
			skyIcon = data.list[i].weather[0].icon;
			$("h3").html(data.city.name);
			htmlString += "<div class='weatherboxes'>";
			htmlString += "<p><span class='bold' id='temp'>" + data.list[i].temp.max + "°/" + data.list[i].temp.min + "°" + "</span></p>";
			htmlString += "<p id='image'><img src=http://openweathermap.org/img/w/" + skyIcon + ".png></p>"; 
			htmlString += "<p>" + "<span class='bold'>Clouds:</span> " + data.list[i].weather[0].main + "</p>";
			htmlString += "<p>" + "<span class='bold'>Humidity:</span> " + data.list[i].humidity + "</p>";
			htmlString += "<p>" + "<span class='bold'>Wind:</span> " + data.list[i].speed + "</p>";
			htmlString += "<p>" + "<span class='bold'>Pressure:</span> " + data.list[i].pressure + "</p>";
		    htmlString += "</div>";
		    $("#row-forecast").html(htmlString);
		    }	
		}).fail(function() {
			alert("fail");
		});
	}


	lat = 29.423017;
	lon = -98.48527;
	// console.log(lat);
	// console.log(lon);
	runGetWeather(lat, lon);

	// Listens to user and calls ajax request with new user input
	$("#search-form").submit(function (e) {
		// Below prevents form's sending data to server
		e.preventDefault();
		var lat = $("#latitude").val();
		var lon = $("#longitude").val();

		$("#location").html("Latitude: " + lat + "  Longitude: " + lon);
		
		console.log("in submit listener");
		console.log(lat);
		console.log(lon);    
		runGetWeather(lat, lon);
	});

	// Parameters for maps, function called after document.ready
	function initialize() {
	var mapOptions = {
      zoom: 10,
      center: { lat: 29.4284595, lng: -98.492433 }
    };

// Renders the map
    var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);
	}


</script>
</body>
</html>
